# ============================================================================
#                        LifeGrid Cloudflare Worker
# ============================================================================
# 统一部署架构: 静态资源 + API Worker 一体化
# 路由逻辑: 
#   - 请求匹配静态文件 → 直接返回
#   - 请求 /api/* → Worker 处理
#   - 其他 → 返回 index.html (SPA)
# ============================================================================

name = "lifegrid"
main = "src/index.js"
compatibility_date = "2026-01-30"
compatibility_flags = ["nodejs_compat"]
account_id = "02c398482d28151eb2aafa68818815ce"

# ============================================================================
#                          Static Assets 配置
# ============================================================================
[assets]
directory = "./public"
binding = "ASSETS"
not_found_handling = "single-page-application"
run_worker_first = ["/generate", "/health"]

# ============================================================================
#                            构建配置
# ============================================================================
[build]
command = "npm install"

# WASM 模块支持 (图像处理)
[[rules]]
type = "CompiledWasm"
globs = ["**/*.wasm"]
